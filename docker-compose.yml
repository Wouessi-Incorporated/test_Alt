version: "3.9"

services:
  altura:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: altura-store
    ports:
      - "3000:3000"
    environment:
      # Server config
      PORT: 3000
      BASE_URL: http://localhost:3000
      
      # Currency
      FX_EURUSD: "1.10"
      
      # Stripe (replace with your keys)
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY:-sk_test_...}
      STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET:-whsec_...}
      
      # PayPal (replace with your credentials)
      PAYPAL_ENV: ${PAYPAL_ENV:-sandbox}
      PAYPAL_CLIENT_ID: ${PAYPAL_CLIENT_ID:-...}
      PAYPAL_CLIENT_SECRET: ${PAYPAL_CLIENT_SECRET:-...}
      
      # Mailjet (replace with your keys)
      MJ_APIKEY_PUBLIC: ${MJ_APIKEY_PUBLIC:-...}
      MJ_APIKEY_PRIVATE: ${MJ_APIKEY_PRIVATE:-...}
      MJ_SENDER_EMAIL: ${MJ_SENDER_EMAIL:-no-reply@altura.com}
      MJ_SENDER_NAME: ${MJ_SENDER_NAME:-ALTURA}
      
      # WhatsApp (optional)
      WA_TOKEN: ${WA_TOKEN:-}
      WA_PHONE_NUMBER_ID: ${WA_PHONE_NUMBER_ID:-}
    
    volumes:
      - ./ALTURA_SERVER/server/data:/app/ALTURA_SERVER/server/data
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "node", "-e", "const p = process.env.PORT || 3000; require('http').get('http://localhost:' + p, (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
